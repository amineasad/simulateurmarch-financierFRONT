<!-- src/app/components/portfolio/portfolio.component.html -->

<div class="portfolio-container">
  
  <!-- Header -->
  <div class="portfolio-header">
    <button class="btn-back" (click)="goBack()">
      ‚Üê Retour au Trading
    </button>
    <h1 class="portfolio-title">Mon Portefeuille</h1>
  </div>

  <!-- Vue d'ensemble -->
  <div class="overview-cards">
    <div class="overview-card">
      <div class="card-label">Valeur Totale</div>
      <div class="card-value">{{ getTotalValue() | number:'1.2-2' }}‚Ç¨</div>
    </div>

    <div class="overview-card">
      <div class="card-label">Cash Disponible</div>
      <div class="card-value cash">{{ cashAvailable | number:'1.2-2' }}‚Ç¨</div>
    </div>

    <div class="overview-card">
      <div class="card-label">Valeur Investie</div>
      <div class="card-value">{{ totalPortfolioValue | number:'1.2-2' }}‚Ç¨</div>
    </div>

    <div class="overview-card" [class.positive]="totalPnL >= 0" [class.negative]="totalPnL < 0">
      <div class="card-label">P&L Total</div>
      <div class="card-value pnl">
        {{ totalPnL >= 0 ? '+' : '' }}{{ totalPnL | number:'1.2-2' }}‚Ç¨
      </div>
    </div>
  </div>

  <!-- Actions rapides -->
  <div class="quick-actions">
    <button class="action-btn btn-primary" (click)="goToOrders()">
      üìù Passer un ordre
    </button>
    <button class="action-btn btn-secondary" (click)="goToWallet()">
      üí∞ G√©rer mon portefeuille
    </button>
  </div>

  <!-- Messages de succ√®s/erreur -->
  <div class="message success-message" *ngIf="successMessage">
    ‚úì {{ successMessage }}
  </div>

  <div class="message error-message" *ngIf="errorMessage">
    ‚ö† {{ errorMessage }}
  </div>

  <!-- NOUVELLE SECTION : Ordres en Attente -->
  <div class="pending-orders-section" *ngIf="pendingOrders.length > 0">
    <h2 class="section-title">‚è≥ Ordres en Attente</h2>

    <div class="pending-orders-list">
      <div class="pending-order-card" *ngFor="let order of pendingOrders">
        <div class="order-header">
          <div class="order-info">
            <span class="symbol">{{ order.symbol }}</span>
            <span class="side" [class.buy]="order.side === 'BUY'" [class.sell]="order.side === 'SELL'">
              {{ order.side === 'BUY' ? 'ACHAT' : 'VENTE' }}
            </span>
            <span class="type">{{ order.type }}</span>
          </div>
          <button class="btn-cancel" (click)="cancelOrder(order.orderId)">
            ‚ùå Annuler
          </button>
        </div>

        <div class="order-details">
          <div class="detail-item">
            <span class="label">Quantit√©</span>
            <span class="value">{{ order.quantity }} actions</span>
          </div>
          <div class="detail-item">
            <span class="label">Prix Limite</span>
            <span class="value">{{ order.price | number:'1.2-2' }}‚Ç¨</span>
          </div>
          <div class="detail-item">
            <span class="label">Date</span>
            <span class="value">{{ order.createdAt }}</span>
          </div>
        </div>

        <div class="order-status">
          <span class="status-badge pending">‚è≥ EN ATTENTE</span>
          <span class="order-explanation">
            Cet ordre sera ex√©cut√© quand le prix {{ order.side === 'BUY' ? 'descendra' : 'montera' }} √† {{ order.price | number:'1.2-2' }}‚Ç¨
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Positions -->
  <div class="positions-section">
    <h2 class="section-title">üìä Mes Positions</h2>

    <div class="positions-list" *ngIf="!isLoading && portfolio.length > 0">
      <div class="position-card" *ngFor="let position of portfolio">
        <div class="position-header">
          <div class="position-symbol">{{ position.symbol }}</div>
          <div class="position-quantity">{{ position.quantity }} actions</div>
        </div>

        <div class="position-details">
          <div class="detail-row">
            <span class="label">Prix Moyen d'Achat (PMR)</span>
            <span class="value">{{ position.avgPrice | number:'1.2-2' }}‚Ç¨</span>
          </div>
          <div class="detail-row">
            <span class="label">Prix Actuel</span>
            <span class="value">{{ position.currentPrice | number:'1.2-2' }}‚Ç¨</span>
          </div>
          <div class="detail-row">
            <span class="label">Valeur Totale</span>
            <span class="value">{{ (position.quantity * position.currentPrice) | number:'1.2-2' }}‚Ç¨</span>
          </div>
        </div>

        <div class="position-pnl" [class.positive]="getPositionPnL(position) >= 0" [class.negative]="getPositionPnL(position) < 0">
          <div class="pnl-label">Plus/Moins-Value</div>
          <div class="pnl-values">
            <span class="pnl-amount">
              {{ getPositionPnL(position) >= 0 ? '+' : '' }}{{ getPositionPnL(position) | number:'1.2-2' }}‚Ç¨
            </span>
            <span class="pnl-percent">
              ({{ getPositionPnL(position) >= 0 ? '+' : '' }}{{ getPositionPnLPercent(position) | number:'1.2-2' }}%)
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="!isLoading && portfolio.length === 0">
      <div class="empty-icon">üìä</div>
      <h3>Aucune position</h3>
      <p>Vous n'avez pas encore d'actions dans votre portefeuille</p>
      <button class="btn-primary" (click)="goToOrders()">
        Commencer √† trader
      </button>
    </div>

    <div class="loading-state" *ngIf="isLoading">
      <p>Chargement du portefeuille...</p>
    </div>
  </div>

</div>