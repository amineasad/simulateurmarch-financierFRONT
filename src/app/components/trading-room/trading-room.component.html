<!-- src/app/components/trading-room/trading-room.component.html -->

<div class="trading-room">
  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="top-bar-left">
      <div class="logo">TRADIX</div>
      <button class="btn-back" (click)="goToLobby()">
        ‚Üê √† la salle de jeu
      </button>
      <div class="time-info">
        <span class="icon">üïê</span>
        <span class="time">{{ currentTime | date:'HH:mm:ss' }}</span>
        <span class="separator">|</span>
        <span class="market-status" [class.open]="isConnected">
          {{ isConnected ? 'MARCH√â OUVERT' : 'MARCH√â FERM√â' }}
        </span>
      </div>
    </div>
    
    <div class="top-bar-right">
      <div class="info-item">
        <span class="icon">üë•</span>
        <span>{{ onlineTraders }} traders en ligne</span>
      </div>
      <div class="info-item latency">
        <span class="icon">üì°</span>
        <span>Latency: {{ latency }}ms</span>
      </div>
      <div class="info-item user">
        <span class="label">User:</span>
        <span class="username">{{ username }}</span>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    
    <!-- LEFT PANEL - Watchlist -->
    <div class="left-panel">
      <div class="panel-header">WATCHLIST</div>
      <div class="asset-list">
        <div *ngFor="let asset of assets" 
             class="asset-item"
             [class.selected]="asset.symbol === selectedSymbol"
             (click)="selectAsset(asset.symbol)">
          <div class="asset-info">
            <div class="asset-symbol">{{ asset.symbol }}</div>
            <div class="asset-name">{{ asset.name }}</div>
          </div>
          <div class="asset-price">
            <div class="price">{{ asset.price | number:'1.2-2' }}‚Ç¨</div>
            <div class="change" [class.positive]="asset.change >= 0" [class.negative]="asset.change < 0">
              <span class="icon">{{ asset.change >= 0 ? '‚ñ≤' : '‚ñº' }}</span>
              {{ asset.change >= 0 ? '+' : '' }}{{ asset.change | number:'1.2-2' }}%
            </div>
          </div>
          <div class="asset-details">
            <span>Vol: {{ asset.volume }}</span>
            <span class="spread">{{ asset.bid }}/{{ asset.ask }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- CENTER PANEL - Main Trading Area -->
    <div class="center-panel">
      
      <!-- Asset Header -->
      <div class="asset-header" *ngIf="selectedAsset">
        <div class="header-left">
          <div class="header-title">
            <span class="symbol">{{ selectedAsset.symbol }}</span>
            <span class="name">{{ selectedAsset.name }}</span>
          </div>
          <div class="header-price">
            <span class="price">{{ selectedAsset.price | number:'1.2-2' }}‚Ç¨</span>
            <span class="change" [class.positive]="selectedAsset.change >= 0" [class.negative]="selectedAsset.change < 0">
              <span class="icon">{{ selectedAsset.change >= 0 ? '‚ñ≤' : '‚ñº' }}</span>
              {{ selectedAsset.change >= 0 ? '+' : '' }}{{ selectedAsset.change | number:'1.2-2' }}%
            </span>
          </div>
        </div>
        <div class="header-right">
          <div class="stat-item">
            <div class="stat-label">BID</div>
            <div class="stat-value bid">{{ selectedAsset.bid }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">ASK</div>
            <div class="stat-value ask">{{ selectedAsset.ask }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">VOLUME</div>
            <div class="stat-value">{{ selectedAsset.volume }}</div>
          </div>
        </div>
      </div>

      <!-- Chart Area -->
      <div class="chart-area">
        <app-price-chart [symbol]="selectedSymbol"></app-price-chart>
      </div>

      <!-- Order Book -->
      <div class="order-book">
        <div class="order-book-header">CARNET D'ORDRES</div>
        <div class="order-book-content">
          <!-- Bids -->
          <div class="order-book-side">
            <div class="order-book-titles">
              <span>PRIX (BID)</span>
              <span>QUANTIT√â</span>
            </div>
            <div class="order-entry bid" *ngFor="let bid of orderBook.bids">
              <span class="price">{{ bid.price | number:'1.2-2' }}</span>
              <span class="quantity">{{ bid.quantity }}</span>
            </div>
          </div>
          <!-- Asks -->
          <div class="order-book-side">
            <div class="order-book-titles">
              <span>PRIX (ASK)</span>
              <span>QUANTIT√â</span>
            </div>
            <div class="order-entry ask" *ngFor="let ask of orderBook.asks">
              <span class="price">{{ ask.price | number:'1.2-2' }}</span>
              <span class="quantity">{{ ask.quantity }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT PANEL - Navigation simplifi√©e -->
    <div class="right-panel">
      
      <!-- R√©sum√© Portefeuille -->
      <div class="portfolio-summary-section">
        <div class="section-header portfolio-header">
          <span>üíº PORTEFEUILLE</span>
          <span class="pnl" [class.positive]="totalPnL >= 0" [class.negative]="totalPnL < 0">
            {{ totalPnL >= 0 ? '+' : '' }}{{ totalPnL | number:'1.2-2' }}‚Ç¨
          </span>
        </div>

        <div class="summary-stats">
          <div class="stat-item">
            <span class="label">Valeur totale</span>
            <span class="value">{{ totalPortfolioValue | number:'1.2-2' }}‚Ç¨</span>
          </div>
          <div class="stat-item">
            <span class="label">Cash disponible</span>
            <span class="value cash">{{ cash | number:'1.2-2' }}‚Ç¨</span>
          </div>
        </div>

        <!-- Boutons de navigation -->
        <div class="action-buttons">
          <button class="nav-btn btn-order" (click)="goToOrders()">
            üìù Passer un ordre
          </button>
          <button class="nav-btn btn-portfolio" (click)="goToPortfolio()">
            üíº Voir d√©tails
          </button>
          <button class="nav-btn btn-wallet" (click)="goToWallet()">
            üí∞ G√©rer portefeuille
          </button>
        </div>
      </div>

      <!-- Positions (aper√ßu simplifi√©) -->
      <div class="positions-preview-section">
        <div class="section-header">
          üìä POSITIONS
        </div>

        <div class="positions-preview-list">
          <div class="position-preview-item" *ngFor="let position of portfolio">
            <div class="position-info">
              <span class="symbol">{{ position.symbol }}</span>
              <span class="quantity">{{ position.quantity }} actions</span>
            </div>
            <div class="position-pnl" 
                 [class.positive]="getPositionPnL(position) >= 0"
                 [class.negative]="getPositionPnL(position) < 0">
              {{ getPositionPnL(position) >= 0 ? '+' : '' }}{{ getPositionPnL(position) | number:'1.2-2' }}‚Ç¨
            </div>
          </div>
        </div>
      </div>

      <!-- Notifications & Chat -->
      <div class="notifications-section">
        <div class="section-header">
          üí¨ NOTIFICATIONS & CHAT
        </div>

        <div class="notifications-list">
          <!-- Notifications -->
          <div *ngFor="let notif of notifications" 
               class="notification-item"
               [ngClass]="'notification-' + notif.type">
            <div class="notification-header">
              <span class="sender">SYST√àME</span>
              <span class="time">{{ notif.time }}</span>
            </div>
            <div class="notification-message">{{ notif.message }}</div>
          </div>

          <!-- Chat Messages -->
          <div *ngFor="let msg of chatMessages" class="chat-message">
            <div class="chat-header">
              <span class="sender">{{ msg.user }}</span>
              <span class="time">{{ msg.time }}</span>
            </div>
            <div class="chat-text">{{ msg.message }}</div>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="chat-input-container">
          <input 
            type="text" 
            [(ngModel)]="chatInput"
            (keyup.enter)="sendChatMessage()"
            placeholder="Envoyer un message..."
            class="chat-input"
            [disabled]="!isConnected">
        </div>
      </div>

    </div>

  </div>

  <!-- BOTTOM STATUS BAR -->
  <div class="bottom-bar">
    <div class="bottom-left">
      <span class="status-item">
        Session: <span class="value">PROD-{{ currentTime | date:'yyyy-MM-dd' }}</span>
      </span>
      <span class="status-item">
        Ordres aujourd'hui: <span class="value highlight">{{ ordersToday }}</span>
      </span>
      <span class="status-item">
        Volume: <span class="value">{{ volumeToday | number:'1.0-0' }}‚Ç¨</span>
      </span>
    </div>
    <div class="bottom-right">
      <div class="connection-status" [class.connected]="isConnected">
        <div class="status-dot"></div>
        <span>{{ isConnected ? 'Connect√© au march√©' : 'D√©connect√©' }}</span>
      </div>
    </div>
  </div>

</div>